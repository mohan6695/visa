<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groups - Visa Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        },
                        group: {
                            blue: '#3b82f6',
                            green: '#10b981',
                            purple: '#8b5cf6',
                            orange: '#f59e0b',
                            red: '#ef4444'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .nav-gradient {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .group-container {
            transition: all 0.3s ease;
        }
        .group-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .member-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            border: 2px solid white;
            margin-left: -8px;
        }
        .group-stats {
            border-top: 1px solid #e5e7eb;
        }
        .activity-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            background-color: #e3f2fd;
            color: #1976d2;
        }
        .online-indicator {
            width: 8px;
            height: 8px;
            background-color: #10b981;
            border-radius: 50%;
            border: 2px solid white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation Bar -->
    <nav class="nav-gradient text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                        <span class="text-pink-600 font-bold text-lg">V</span>
                    </div>
                    <span class="text-xl font-bold">Visa Platform</span>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="index.html" class="hover:text-pink-200 transition-colors">Home</a>
                    <a href="countries.html" class="hover:text-pink-200 transition-colors">Countries</a>
                    <a href="communities.html" class="hover:text-pink-200 transition-colors">Communities</a>
                    <a href="interview-experience.html" class="hover:text-pink-200 transition-colors">Interview Experience</a>
                    <a href="posts.html" class="hover:text-pink-200 transition-colors">Posts</a>
                    <a href="groups.html" class="text-pink-200 font-semibold border-b-2 border-pink-200">Groups</a>
                    <button class="bg-white text-pink-600 px-4 py-2 rounded-lg font-medium hover:bg-pink-50 transition-colors">
                        Sign In
                    </button>
                </div>
                <div class="md:hidden">
                    <button class="text-white hover:text-pink-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Search and Filter Section -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
                <div class="flex-1 max-w-lg">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Search groups..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent">
                        <button onclick="searchGroups()" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-group-blue text-white px-4 py-1 rounded hover:bg-blue-700 transition-colors">
                            Search
                        </button>
                    </div>
                </div>
                <div class="flex gap-2">
                    <select id="type-filter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent">
                        <option value="">All Types</option>
                        <option value="h1b">H1-B Workers</option>
                        <option value="f1">F-1 Students</option>
                        <option value="eb1">EB-1 Applicants</option>
                        <option value="eb2">EB-2 Applicants</option>
                        <option value="family">Family</option>
                        <option value="general">General</option>
                    </select>
                    <select id="country-filter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent">
                        <option value="">All Countries</option>
                        <option value="usa">USA</option>
                        <option value="canada">Canada</option>
                        <option value="uk">UK</option>
                        <option value="australia">Australia</option>
                        <option value="global">Global</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

            <!-- Main Groups Area -->
            <div class="lg:col-span-3">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Immigration Groups</h2>
                    <div class="text-sm text-gray-600">
                        <span id="groups-count">0</span> groups found
                    </div>
                </div>
                
                <div id="groups-container" class="space-y-6">
                    <!-- Groups will be loaded here -->
                </div>
                
                <div id="loading-spinner" class="hidden text-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-group-blue mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading groups...</p>
                </div>
                
                <div id="no-groups" class="hidden text-center py-8 text-gray-500">
                    No groups found. Create your own group or check back later!
                </div>
            </div>

            <!-- Sidebar with Activity -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 sticky top-4">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Group Activity</h3>
                    <div id="group-activity" class="space-y-4">
                        <!-- Activity will be loaded here -->
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">Quick Stats</h4>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600" id="total-groups">0</div>
                                <div class="text-xs text-blue-600">Total Groups</div>
                            </div>
                            <div class="bg-green-50 p-3 rounded-lg">
                                <div class="text-2xl font-bold text-green-600" id="total-members">0</div>
                                <div class="text-xs text-green-600">Total Members</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div id="create-group-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-900">Create Group</h3>
                    <button onclick="closeCreateGroupModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="create-group-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Group Type</label>
                            <select name="type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent">
                                <option value="general">General Immigration</option>
                                <option value="h1b">H1-B Workers</option>
                                <option value="f1">F-1 Students</option>
                                <option value="eb1">EB-1 Applicants</option>
                                <option value="eb2">EB-2 Applicants</option>
                                <option value="family">Family</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                            <select name="country" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent">
                                <option value="global">Global</option>
                                <option value="usa">USA</option>
                                <option value="canada">Canada</option>
                                <option value="uk">UK</option>
                                <option value="australia">Australia</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                        <input type="text" name="name" placeholder="e.g., H1B Warriors 2024" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea name="description" rows="4" placeholder="Describe what your group is about..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rules</label>
                        <textarea name="rules" rows="3" placeholder="Set community guidelines..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-group-blue focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="flex justify-end gap-3">
                        <button type="button" onclick="closeCreateGroupModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="bg-group-blue text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Create Group
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-8 h-8 bg-pink-600 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold">V</span>
                        </div>
                        <span class="text-xl font-bold">Visa Platform</span>
                    </div>
                    <p class="text-gray-400">
                        Your trusted partner for global visa information and immigration guidance.
                    </p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="index.html" class="hover:text-white transition-colors">Home</a></li>
                        <li><a href="countries.html" class="hover:text-white transition-colors">All Countries</a></li>
                        <li><a href="communities.html" class="hover:text-white transition-colors">Communities</a></li>
                        <li><a href="interview-experience.html" class="hover:text-white transition-colors">Interview Experience</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Popular Countries</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="country-usa.html" class="hover:text-white transition-colors">United States</a></li>
                        <li><a href="country-canada.html" class="hover:text-white transition-colors">Canada</a></li>
                        <li><a href="country-uk.html" class="hover:text-white transition-colors">United Kingdom</a></li>
                        <li><a href="country-australia.html" class="hover:text-white transition-colors">Australia</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="help.html" class="hover:text-white transition-colors">Help Center</a></li>
                        <li><a href="contact.html" class="hover:text-white transition-colors">Contact Us</a></li>
                        <li><a href="privacy.html" class="hover:text-white transition-colors">Privacy Policy</a></li>
                        <li><a href="terms.html" class="hover:text-white transition-colors">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 Visa Platform. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        let joinedGroups = [];

        // Features Builder functionality
        function initFeaturesBuilder() {
            const lane = document.getElementById('features-lane');

            if (!lane) return;

            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', chip.dataset.feature);
                });
            });

            lane.addEventListener('dragover', e => {
                e.preventDefault();
            });

            lane.addEventListener('drop', e => {
                e.preventDefault();
                const feature = e.dataTransfer.getData('text/plain');
                if (!feature) return;
                addFeature(feature);
            });

            function addFeature(feature) {
                // remove placeholder text
                const p = lane.querySelector('p');
                if (p) p.remove();

                const block = document.createElement('div');
                block.className = 'feature-block';
                block.style.cssText = 'display: flex; gap: 8px; margin-bottom: 12px; align-items: flex-start;';

                const label = document.createElement('div');
                label.className = 'feature-label';
                label.style.cssText = 'min-width: 120px; padding: 6px 10px; border-radius: 999px; border: 2px solid #111; background: #eee; text-align: center; font-weight: 600; font-size: 12px;';
                label.textContent = getFeatureLabel(feature);

                const textarea = document.createElement('textarea');
                textarea.placeholder = `Describe ${getFeatureLabel(feature).toLowerCase()}...`;
                textarea.style.cssText = 'flex: 1; min-height: 60px; resize: vertical; padding: 8px; border: 1px solid #ccc; border-radius: 4px;';

                block.appendChild(label);
                block.appendChild(textarea);
                lane.appendChild(block);
            }

            function getFeatureLabel(feature) {
                const labels = {
                    'weekly-chat': 'ðŸ’¬ Weekly Chats',
                    'document-sharing': 'ðŸ“„ Document Sharing',
                    'mentorship': 'ðŸŽ¯ Mentorship',
                    'events': 'ðŸ“… Events',
                    'job-board': 'ðŸ’¼ Job Board',
                    'success-stories': 'ðŸŒŸ Success Stories'
                };
                return labels[feature] || feature;
            }
        }

        function clearAllFeatures() {
            const lane = document.getElementById('features-lane');
            lane.innerHTML = '<p style="color:#999;margin:0;text-align:center;">Drag group features here...</p>';
        }

        // Create Group function
        function createGroup() {
            const type = document.getElementById('group-type').value;
            const country = document.getElementById('group-country').value;
            const name = document.getElementById('group-name').value;
            const description = document.getElementById('group-description').value;
            const rules = document.getElementById('group-rules').value;
            const features = document.querySelectorAll('#features-lane .feature-block');

            if (!type || !country || !name || !description) {
                alert('Please fill all required fields.');
                return;
            }

            const groupFeatures = [];
            features.forEach(feature => {
                const label = feature.querySelector('.feature-label').textContent;
                const text = feature.querySelector('textarea').value;
                if (text.trim().length > 0) {
                    groupFeatures.push({ feature: label, description: text });
                }
            });

            const group = {
                type,
                country,
                name,
                description,
                rules,
                features: groupFeatures,
                timestamp: new Date().toLocaleDateString(),
                members: 1
            };

            joinedGroups.push(group);
            displayJoinedGroup(group);

            // Clear form
            document.getElementById('group-type').value = '';
            document.getElementById('group-country').value = '';
            document.getElementById('group-name').value = '';
            document.getElementById('group-description').value = '';
            document.getElementById('group-rules').value = '';
            clearAllFeatures();

            console.log('Submit payload:', group);
            alert('Group created successfully! Check console for payload data.');
        }

        function displayJoinedGroup(group) {
            const container = document.getElementById('joined-groups');

            // Clear empty state
            const emptyState = container.querySelector('.text-center.text-gray-500');
            if (emptyState) {
                emptyState.remove();
            }

            const div = document.createElement('div');
            div.className = 'joined-group bg-gray-50 p-6 rounded-lg border';
            div.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-2">
                        <span class="member-tag bg-${getTypeColor(group.type)}-100 text-${getTypeColor(group.type)}-800 px-2 py-1 rounded text-xs font-medium">${group.type.toUpperCase()}</span>
                        <span class="text-sm text-gray-600">${getCountryName(group.country)}</span>
                    </div>
                    <span class="text-xs text-gray-400">${group.timestamp}</span>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">${group.name}</h3>
                <p class="text-gray-700 mb-4">${group.description}</p>
                ${group.rules ? `
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 mb-4">
                        <h4 class="font-semibold text-blue-900 mb-2">Group Rules</h4>
                        <p class="text-blue-800 text-sm">${group.rules}</p>
                    </div>
                ` : ''}
                ${group.features.length > 0 ? `
                    <div class="space-y-3 mb-4">
                        <h4 class="font-semibold text-gray-900">Group Features</h4>
                        ${group.features.map(feature => `
                            <div class="bg-white p-3 rounded-lg border border-gray-200">
                                <h5 class="font-medium text-gray-900 mb-1">${feature.feature}</h5>
                                <p class="text-gray-700 text-sm">${feature.description}</p>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                <div class="flex items-center justify-between text-sm text-gray-500">
                    <span>${group.members} member${group.members > 1 ? 's' : ''}</span>
                    <div class="space-x-3">
                        <button onclick="editGroup(this)" class="text-blue-600 hover:text-blue-800">Edit</button>
                        <button onclick="deleteGroup(this)" class="text-red-500 hover:text-red-700">Delete</button>
                    </div>
                </div>
            `;
            container.insertBefore(div, container.firstChild);
        }

        function getTypeColor(type) {
            const colors = {
                h1b: 'green',
                f1: 'blue',
                eb1: 'purple',
                eb2: 'indigo',
                family: 'pink',
                general: 'gray',
                'country-specific': 'orange',
                professional: 'teal'
            };
            return colors[type] || 'gray';
        }

        function getCountryName(code) {
            const countries = {
                usa: 'United States',
                canada: 'Canada',
                uk: 'United Kingdom',
                australia: 'Australia',
                germany: 'Germany',
                france: 'France',
                multiple: 'Multiple Countries',
                global: 'Global'
            };
            return countries[code] || code;
        }

        function joinGroup(button) {
            const groupCard = button.closest('.group-card');
            const groupName = groupCard.querySelector('h4').textContent;
            button.textContent = 'Joined';
            button.classList.remove('text-blue-600', 'hover:text-blue-800');
            button.classList.add('text-green-600', 'cursor-not-allowed');
            button.disabled = true;

            // Update member count
            const membersSpan = groupCard.querySelector('.text-xs.text-gray-5');
            if (membersSpan) {
                const currentCount = parseInt(membersSpan.textContent.replace(/[^\d]/g, ''));
                membersSpan.textContent = `${currentCount + 1} members`;
            }

            alert(`Successfully joined "${groupName}"!`);
        }

        function editGroup(button) {
            alert('Edit group functionality would be implemented here.');
        }

        function deleteGroup(button) {
            if (confirm('Are you sure you want to delete this group?')) {
                button.closest('.joined-group').remove();

                // Show empty state if no groups left
                const container = document.getElementById('joined-groups');
                if (container.children.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <p>No groups created yet. Create your first group above!</p>
                        </div>
                    `;
                }
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initFeaturesBuilder();
        });
    </script>
</body>
</html>