# Render Deployment Configuration for Hybrid PostHog Analytics
# This file can be used with Render's blueprint deployment feature

services:
  # PostHog Self-Hosted Instance
  - type: web
    name: posthog
    env: python
    plan: free
    buildCommand: |
      pip install -r requirements.txt
    startCommand: |
      gunicorn posthog.wsgi:application --bind 0.0.0.0:$PORT
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: false
      - key: DATABASE_URL
        fromDatabase:
          name: posthog-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: posthog-redis
          property: connectionString
      - key: DISABLE_SECURE_SSL_REDIRECT
        value: "true"
      - key: SITE_URL
        fromService:
          type: web
          name: posthog
          property: host
      - key: EMAIL_ENABLED
        value: "false"
      - key: POSTHOG_USAGE_BILLING
        value: "false"
      - key: POSTHOG_SENTRY_DSN
        value: ""

databases:
  - name: posthog-db
    databaseName: posthog
    user: posthog

  # Supabase PostgreSQL (for local event storage)
  # Note: This should be your existing Supabase project
  # You don't need to create a new database for analytics events
  # They will be stored in your existing Supabase database

redis:
  - name: posthog-redis
    plan: free

  # Note: For local Redis caching, you can use your existing Redis setup
  # or create a new Redis instance for application caching